# .github/workflows/oss_tests.yml
name: OSS Boundary Tests

on:
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'agentic_reliability_framework/arf_core/**'
      - 'scripts/**'
      - '.github/workflows/oss_tests.yml'

jobs:
  oss-boundary:
    name: OSS Boundary Validation
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Basic OSS structure check
      run: |
        echo "üîç BASIC OSS STRUCTURE CHECK"
        echo "============================"
        
        # 1. Check arf_core directory exists
        if [ -d "agentic_reliability_framework/arf_core" ]; then
          echo "‚úÖ arf_core directory exists"
        else
          echo "‚ùå arf_core directory missing"
          exit 1
        fi
        
        # 2. Check critical files exist
        echo ""
        echo "Checking critical files:"
        
        CRITICAL_FILES=(
          "__init__.py"
          "constants.py"
        )
        
        all_exist=true
        for file in "${CRITICAL_FILES[@]}"; do
          full_path="agentic_reliability_framework/arf_core/$file"
          if [ -f "$full_path" ]; then
            echo "   ‚úÖ $file"
          else
            echo "   ‚ùå $file - MISSING"
            all_exist=false
          fi
        done
        
        if [ "$all_exist" = false ]; then
          echo "‚ùå Missing critical files"
          exit 1
        fi
        
        # 3. Check constants.py for OSS keywords
        echo ""
        echo "Checking constants.py:"
        CONSTANTS_FILE="agentic_reliability_framework/arf_core/constants.py"
        
        if grep -q "advisory" "$CONSTANTS_FILE"; then
          echo "   ‚úÖ Mentions 'advisory' mode"
        else
          echo "   ‚ö†Ô∏è  Does not mention 'advisory'"
        fi
        
        if grep -q "in_memory" "$CONSTANTS_FILE"; then
          echo "   ‚úÖ Mentions 'in_memory' storage"
        else
          echo "   ‚ö†Ô∏è  Does not mention 'in_memory'"
        fi
        
        # 4. Check for ABSOLUTE NO-NO patterns
        echo ""
        echo "Checking for absolute no-nos:"
        
        ABSOLUTE_NO_NOS=(
          "EnterpriseMCPServer"
          "LicenseManager"
          "license_key"
          "ARF-ENT-"
        )
        
        found_no_nos=false
        for pattern in "${ABSOLUTE_NO_NOS[@]}"; do
          if grep -r "$pattern" agentic_reliability_framework/arf_core/ --include="*.py" 2>/dev/null; then
            echo "   ‚ùå Found absolute no-no: $pattern"
            found_no_nos=true
          fi
        done
        
        if [ "$found_no_nos" = true ]; then
          echo "‚ùå Found absolute no-nos in OSS code"
          exit 1
        else
          echo "   ‚úÖ No absolute no-nos found"
        fi
        
        echo ""
        echo "üéâ BASIC OSS CHECK PASSED!"
        echo ""
        echo "Note: This is a minimal check to ensure OSS purity."
        echo "For more detailed checks, run scripts/oss_boundary_check.py locally."
