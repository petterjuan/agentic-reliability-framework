# .github/workflows/oss_tests.yml - UPDATED
name: OSS Boundary Tests

on:
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'agentic_reliability_framework/arf_core/**'
      - 'scripts/**'

jobs:
  oss-boundary:
    name: OSS Boundary Validation
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Run simplified OSS boundary check
      run: |
        python scripts/oss_boundary_check.py
        
    - name: Check for basic OSS violations
      run: |
        echo "Running quick OSS violation checks..."
        
        # Check OSS directories for Enterprise patterns
        OSS_DIRS="agentic_reliability_framework/arf_core"
        
        for dir in $OSS_DIRS; do
          if [ -d "$dir" ]; then
            echo "Checking $dir for Enterprise patterns..."
            
            # Check for Enterprise module names
            if grep -r "arf_enterprise\|EnterpriseMCPServer\|LicenseManager" "$dir" --include="*.py"; then
              echo "❌ Found Enterprise patterns in $dir"
              exit 1
            fi
            
            # Check for execution modes other than advisory
            if grep -r "MCPMode\.APPROVAL\|MCPMode\.AUTONOMOUS" "$dir" --include="*.py"; then
              echo "❌ Found non-advisory modes in $dir"
              exit 1
            fi
          fi
        done
        
        echo "✅ Basic OSS checks passed"
